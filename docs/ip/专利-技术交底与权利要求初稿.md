# Mini Bob 发明专利技术交底书（含权利要求初稿）

## 0. 使用说明
- 本稿是按你当前代码实现整理的“工程可落地版”交底稿。
- 可作为与专利代理人沟通底稿，代理人会再做法律语言优化。

## 1. 建议专利名称
`一种基于选区锚点和多服务并行流式路由的实时文本翻译方法、系统、设备及存储介质`

## 2. 技术领域
本发明涉及自然语言处理与桌面软件交互技术，具体涉及一种在桌面应用中自动获取选中文本并进行多服务并行流式翻译的实现方法。

## 3. 背景技术
现有划词翻译工具常见问题：
1. 首次触发响应慢，窗口与内容不同步。
2. 选中文本读取依赖单一路径，跨应用成功率不稳定。
3. 多模型服务切换成本高，失败后用户感知差。
4. 流式输出阶段窗口尺寸抖动或闪动，阅读体验差。

## 4. 发明目的
提出一种低等待、高稳定、可并行多服务输出的桌面实时翻译方案，解决选区读取、服务路由、流式渲染与气泡交互稳定性问题。

## 5. 技术方案（核心步骤）

### S1：快捷键触发与窗口预开
接收全局快捷键信号后，先以非抢焦点方式显示翻译气泡并进入“读取中”状态，缩短首屏感知延迟。

### S2：选区文本双路径读取
并行或竞速执行：
1. 辅助功能读取路径（可带选区锚点坐标）。
2. 自动复制路径（系统复制指令 + 剪贴板轮询 + 超时控制）。
取先到且有效结果作为原文，未命中时走错误提示分支。

### S3：文本自动化预处理
根据配置执行至少一项：
1. 换行规整为单空格；
2. 代码注释符清理；
3. 断词连字符修复（例如 `insignif- \n icant` -> `insignificant`）。

### S4：服务路由排序
针对多个翻译服务维护运行指标，至少包括：
1. EWMA 时延；
2. 连续失败次数；
3. 超时连续次数；
4. 失败率。
按综合得分排序形成请求队列。

### S5：多服务并行翻译与流式聚合
对候选服务并行发起翻译请求，每个服务独立维护状态机：`pending/running/streaming/done/error`，并将增量内容持续推送至前端分服务卡片。

### S6：气泡稳定展示机制
1. 窗口固定宽度，按内容流式增长动态调高高度；
2. 支持钉住与拖动；
3. 外部点击自动隐藏，并以读取中保护位避免误隐藏。

## 6. 有益效果
1. 首屏响应速度提升，降低用户“无反馈等待”。
2. 选区读取成功率提高，跨应用兼容性更好。
3. 多服务并行结果可见，避免单服务失败导致整体不可用。
4. 流式阶段窗口更稳定，减少闪动与布局抖动。

## 7. 实施例参数（可写入说明书）
1. 复制触发超时：400~600ms 区间可配置。  
2. 复制重试次数：1~3 次可配置。  
3. 流式刷新节流：30~80ms 可配置。  
4. 路由评分可按 `score = ewma + a*failStreak + b*timeoutStreak + c*failureRate`。  
5. 气泡窗口采用固定宽度阈值、动态高度上限策略。

## 8. 权利要求书初稿

### 权利要求1（独立方法权利要求）
一种实时文本翻译方法，其特征在于，包括：  
1. 接收全局快捷键触发信号后，显示翻译窗口并进入选区读取状态；  
2. 通过辅助功能读取路径与自动复制路径获取选中文本，并从至少两条路径中确定有效原文文本；  
3. 对所述原文文本执行可配置自动化预处理；  
4. 基于各翻译服务的历史运行指标进行排序，得到目标服务集合；  
5. 对目标服务集合并行发起流式翻译请求，并按服务维度输出增量译文；  
6. 在翻译输出过程中维持窗口固定宽度并依据译文内容动态调整高度。

### 权利要求2
根据权利要求1所述的方法，其中所述历史运行指标至少包括指数加权移动平均时延、连续失败次数、连续超时次数和失败率中的一种或多种。

### 权利要求3
根据权利要求1所述的方法，其中在自动复制路径中通过向系统发送复制快捷键、写入剪贴板标记并轮询检测变化以确认复制结果。

### 权利要求4
根据权利要求1所述的方法，其中所述自动化预处理包括去除代码注释标记、换行转空格和断词连字符修复中的至少一项。

### 权利要求5
根据权利要求1所述的方法，其中对各翻译服务维护状态机，状态至少包括待处理、处理中、流式输出、完成和失败。

### 权利要求6
根据权利要求1所述的方法，其中窗口设置为气泡模式时支持钉住状态，在钉住状态下禁用失焦自动隐藏。

### 权利要求7
根据权利要求1所述的方法，其中当检测到外部点击事件且满足非读取保护状态时，执行窗口自动隐藏。

### 权利要求8
根据权利要求1所述的方法，其中所述翻译窗口按照选区锚点位置显示，而非按照鼠标当前位置显示。

### 权利要求9
根据权利要求1所述的方法，其中并行翻译结果以独立服务卡片展示，每个卡片展示服务标识、模型标识、译文内容和错误状态。

### 权利要求10
根据权利要求1所述的方法，其中当流式请求失败且未产生有效增量内容时，自动切换至同一服务的非流式请求路径进行补偿。

### 权利要求11（独立系统权利要求）
一种实时文本翻译系统，包括：  
1. 触发模块，用于接收全局快捷键事件；  
2. 选区读取模块，用于通过至少两条读取路径获取选中文本；  
3. 预处理模块，用于对原文执行自动化规整；  
4. 路由模块，用于根据服务运行指标进行服务排序；  
5. 翻译模块，用于执行多服务并行流式翻译；  
6. 展示模块，用于以固定宽度、动态高度方式展示多服务译文结果。

### 权利要求12（介质权利要求）
一种计算机可读存储介质，其上存储有计算机程序，所述程序被处理器执行时实现权利要求1至10任一项所述的方法。

## 9. 官方依据（已核对）
- 《中华人民共和国专利法》第二十六条（发明/实用新型申请文件构成）：  
  `https://www.gov.cn/xinwen/2020-10/21/content_5552993.htm`
- 国家知识产权局专利业务办理系统（电子申请入口）：  
  `https://cponline.cnipa.gov.cn/`
- 国家知识产权局电子申请系统迁移及新入口通知（确认入口与时间）：  
  `https://www.cnipa.gov.cn/art/2023/12/28/art_53_189636.html`

